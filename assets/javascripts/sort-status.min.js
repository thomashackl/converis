$(function(){let oldPosition=0;let newPosition=0;let table=$("table.status");table.sortable({axis:"y",cursor:"move",items:"tr.status-sort",placeholder:"status-placeholder",start:function(a,b){let elements=table.sortable("toArray");oldPosition=elements.indexOf(b.item.attr("id"))},stop:function(a,b){let elements=table.sortable("toArray");newPosition=elements.indexOf(b.item.attr("id"));$.ajax({type:"POST",url:table.data("update-position-url"),dataType:"json",data:{status:b.item.data("status-id"),oldpos:oldPosition,newpos:newPosition},success:function(d,c,e){if(d!=null){b.item.children("td").first().html(newPosition+".");b.item.addClass("sort-success");for(let i=0;i<d.length;i++){$("#status-"+d[i].status_id).children("td").first().html((parseInt(d[i].position)+1)+".")}setTimeout(function(){b.item.removeClass("sort-success")},2000)}else{table.sortable("cancel");b.item.addClass("sort-failed");setTimeout(function(){b.item.removeClass("sort-failed")},2000)}},error:function(e,c,d){table.sortable("cancel");b.item.addClass("sort-failed");alert(d);setTimeout(function(){b.item.removeClass("sort-failed")},2000)}})}})});